{"version":3,"file":"lit-element_styling_test.js","sourceRoot":"","sources":["../src/test/lit-element_styling_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport '@webcomponents/shadycss/apply-shim.min.js';\n\nimport {\n  html as htmlWithStyles,\n  LitElement,\n} from '../lit-element.js';\n\nimport {\n  generateElementName,\n  getComputedStyleValue,\n  nextFrame\n} from './test-helpers.js';\n\ndeclare global {\n  interface Window {\n    ShadyDOM: any; // tslint:disable-line\n  }\n}\n\nconst assert = chai.assert;\n\nsuite('Styling', () => {\n  let container: HTMLElement;\n\n  setup(() => {\n    container = document.createElement('div');\n    document.body.appendChild(container);\n  });\n\n  teardown(() => {\n    if (container && container.parentNode) {\n      container.parentNode.removeChild(container);\n    }\n  });\n\n  test('content shadowRoot is styled', async () => {\n    const name = generateElementName();\n    customElements.define(name, class extends LitElement {\n      render() {\n        return htmlWithStyles`\n        <style>\n          div {\n            border: 2px solid blue;\n          }\n        </style>\n        <div>Testing...</div>`;\n      }\n    });\n    const el = document.createElement(name);\n    container.appendChild(el);\n    await (el as LitElement).updateComplete;\n    const div = el.shadowRoot!.querySelector('div');\n    assert.equal(getComputedStyleValue(div!, 'border-top-width').trim(), '2px');\n  });\n\n  test('shared styling rendered into shadowRoot is styled', async () => {\n    const style = htmlWithStyles`<style>\n      div {\n        border: 4px solid blue;\n      }\n    </style>`;\n    const name = generateElementName();\n    customElements.define(name, class extends LitElement {\n      render() {\n        return htmlWithStyles`\n        <style>\n          div {\n            border: 2px solid blue;\n          }\n        </style>\n        ${style}\n        <div>Testing...</div>`;\n      }\n    });\n    const el = document.createElement(name);\n    container.appendChild(el);\n    await (el as LitElement).updateComplete;\n    const div = el.shadowRoot!.querySelector('div');\n    assert.equal(getComputedStyleValue(div!, 'border-top-width').trim(), '4px');\n  });\n\n  test('custom properties render', async () => {\n    const name = generateElementName();\n    customElements.define(name, class extends LitElement {\n      render() {\n        return htmlWithStyles`\n        <style>\n          :host {\n            --border: 8px solid red;\n          }\n          div {\n            border: var(--border);\n          }\n        </style>\n        <div>Testing...</div>`;\n      }\n    });\n    const el = document.createElement(name);\n    container.appendChild(el);\n    await (el as LitElement).updateComplete;\n    const div = el.shadowRoot!.querySelector('div');\n    assert.equal(getComputedStyleValue(div!, 'border-top-width').trim(), '8px');\n  });\n\n  test('custom properties flow to nested elements', async () => {\n    customElements.define('x-inner', class extends LitElement {\n      render() {\n        return htmlWithStyles`\n        <style>\n          div {\n            border: var(--border);\n          }\n        </style>\n        <div>Testing...</div>`;\n      }\n    });\n    const name = generateElementName();\n    class E extends LitElement {\n      inner: LitElement|null = null;\n\n      render() {\n        return htmlWithStyles`\n        <style>\n          x-inner {\n            --border: 8px solid red;\n          }\n        </style>\n        <x-inner></x-inner>`;\n      }\n\n      firstUpdated() {\n        this.inner = this.shadowRoot!.querySelector('x-inner')! as LitElement;\n      }\n    }\n    customElements.define(name, E);\n    const el = document.createElement(name) as E;\n    container.appendChild(el);\n\n    // Workaround for Safari 9 Promise timing bugs.\n    await el.updateComplete && await el.inner!.updateComplete;\n\n    await nextFrame();\n    const div = el.inner!.shadowRoot!.querySelector('div');\n    assert.equal(getComputedStyleValue(div!, 'border-top-width').trim(), '8px');\n  });\n\n  test('elements with custom properties can move between elements',\n       async () => {\n         customElements.define('x-inner1', class extends LitElement {\n           render() {\n             return htmlWithStyles`\n        <style>\n          div {\n            border: var(--border);\n          }\n        </style>\n        <div>Testing...</div>`;\n           }\n         });\n         const name1 = generateElementName();\n         customElements.define(name1, class extends LitElement {\n           inner: Element|null = null;\n\n           render() {\n             return htmlWithStyles`\n        <style>\n          x-inner1 {\n            --border: 2px solid red;\n          }\n        </style>\n        <x-inner1></x-inner1>`;\n           }\n\n           firstUpdated() {\n             this.inner = this.shadowRoot!.querySelector('x-inner1');\n           }\n         });\n         const name2 = generateElementName();\n         customElements.define(name2, class extends LitElement {\n           render() {\n             return htmlWithStyles`\n        <style>\n          x-inner1 {\n            --border: 8px solid red;\n          }\n        </style>`;\n           }\n         });\n         const el = document.createElement(name1) as LitElement;\n         const el2 = document.createElement(name2);\n         container.appendChild(el);\n         container.appendChild(el2);\n         let div: Element|null;\n\n         // Workaround for Safari 9 Promise timing bugs.\n         await el.updateComplete;\n\n         await nextFrame();\n         const inner = el.shadowRoot!.querySelector('x-inner1');\n         div = inner!.shadowRoot!.querySelector('div');\n         assert.equal(getComputedStyleValue(div!, 'border-top-width').trim(),\n                      '2px');\n         el2!.shadowRoot!.appendChild(inner!);\n\n         // Workaround for Safari 9 Promise timing bugs.\n         await el.updateComplete;\n\n         await nextFrame();\n         assert.equal(getComputedStyleValue(div!, 'border-top-width').trim(),\n                      '8px');\n       });\n\n  test('@apply renders in nested elements', async () => {\n    customElements.define('x-inner2', class extends LitElement {\n      render() {\n        return htmlWithStyles`\n        <style>\n          div {\n            @apply --bag;\n          }\n        </style>\n        <div>Testing...</div>`;\n      }\n    });\n    const name = generateElementName();\n    class E extends LitElement {\n      inner: LitElement|null = null;\n      render() {\n        return htmlWithStyles`\n        <style>\n          x-inner2 {\n            --bag: {\n              border: 10px solid red;\n            }\n          }\n        </style>\n        <x-inner2></x-inner2>`;\n      }\n\n      firstUpdated() {\n        this.inner = this.shadowRoot!.querySelector('x-inner2') as LitElement;\n      }\n    }\n    customElements.define(name, E);\n    const el = document.createElement(name) as E;\n    container.appendChild(el);\n\n    // Workaround for Safari 9 Promise timing bugs.\n    await el.updateComplete && await el.inner!.updateComplete;\n\n    await nextFrame();\n    const div = el.shadowRoot!.querySelector(\n                                  'x-inner2')!.shadowRoot!.querySelector('div');\n    assert.equal(getComputedStyleValue(div!, 'border-top-width').trim(),\n                 '10px');\n  });\n\n  test(\n      '@apply renders in nested elements when sub-element renders separately first',\n      async () => {\n        class I extends LitElement {\n          render() {\n            return htmlWithStyles`\n        <style>\n          :host {\n            display: block;\n            width: 100px;\n            height: 100px;\n            border: 2px solid black;\n            margin-top: 10px;\n            @apply --bag;\n          }\n        </style>Hi`;\n          }\n        }\n        customElements.define('x-applied', I);\n\n        const name = generateElementName();\n        class E extends LitElement {\n          applied: HTMLElement|undefined;\n\n          render() {\n            return htmlWithStyles`\n        <style>\n          :host {\n            --bag: {\n              border: 10px solid black;\n              margin-top: 2px;\n            }\n          }\n        </style>\n        <x-applied></x-applied>`;\n          }\n\n          firstUpdated() {\n            this.applied =\n                this.shadowRoot!.querySelector('x-applied') as LitElement;\n          }\n        }\n        customElements.define(name, E);\n\n        const firstApplied = document.createElement('x-applied') as I;\n        container.appendChild(firstApplied);\n        const el = document.createElement(name) as E;\n        container.appendChild(el);\n\n        // Workaround for Safari 9 Promise timing bugs.\n        await firstApplied.updateComplete && el.updateComplete &&\n            await (el.applied as I)!.updateComplete;\n\n        await nextFrame();\n        assert.equal(\n            getComputedStyleValue(firstApplied!, 'border-top-width').trim(),\n            '2px');\n        assert.equal(getComputedStyleValue(firstApplied!, 'margin-top').trim(),\n                     '10px');\n        assert.equal(\n            getComputedStyleValue(el.applied!, 'border-top-width').trim(),\n            '10px');\n        assert.equal(getComputedStyleValue(el.applied!, 'margin-top').trim(),\n                     '2px');\n      });\n});\n\nsuite('ShadyDOM', () => {\n  let container: HTMLElement;\n\n  setup(function() {\n    if (!window.ShadyDOM) {\n      this.skip();\n    } else {\n      container = document.createElement('div');\n      document.body.appendChild(container);\n    }\n  });\n\n  teardown(() => {\n    if (container && container.parentNode) {\n      container.parentNode.removeChild(container);\n    }\n  });\n\n  test('properties in styles render with initial value and cannot be changed',\n       async () => {\n         let border = `6px solid blue`;\n         const name = generateElementName();\n         customElements.define(name, class extends LitElement {\n           render() {\n             return htmlWithStyles`\n        <style>\n          div {\n            border: ${border};\n          }\n        </style>\n        <div>Testing...</div>`;\n           }\n         });\n         const el = document.createElement(name) as LitElement;\n         container.appendChild(el);\n         await el.updateComplete;\n         const div = el.shadowRoot!.querySelector('div');\n         assert.equal(getComputedStyleValue(div!, 'border-top-width').trim(),\n                      '6px');\n         border = `4px solid orange`;\n         el.requestUpdate();\n         await el.updateComplete;\n         assert.equal(getComputedStyleValue(div!, 'border-top-width').trim(),\n                      '6px');\n       });\n});\n"]}